!function(){angular.module("starter",["ionic","starter.controllers","starter.services","angularMoment","ngCordova","firebase"]).run(["$ionicPlatform","$state","ConfigurationService","UserService","EntityService",function(e,t,o,r,s){e.on("pause",function(){Firebase.goOffline()}),e.on("resume",function(){Firebase.goOnline()}),e.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(setTimeout(function(){navigator.splashscreen.hide()},50),cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault();var e=!1;if(window.cordova&&"undefined"!=typeof window.plugins.OneSignal){var n=function(o){var r={conversationId:o.additionalData.conversationId,userName:o.additionalData.userName,subjectName:o.additionalData.subjectName,fbPhotoUrl:o.additionalData.fbPhotoUrl};e=!0,s.setMessageDetails(r),t.go("chat")};window.plugins.OneSignal.init("ee6f85c1-a2ff-4d1b-9fa6-29dd4cc306ef",{googleProjectNumber:"238478083352"},n),window.plugins.OneSignal.enableNotificationsWhenActive(!1)}var i=o.UserDetails();i?r.CheckUser().then(function(o){if(o.isNeedLogin===!1){var r=new Firebase("https://chatoi.firebaseio.com");r.authWithCustomToken(o.fireToken,function(o,r){o?console.log("Login Failed!",o):e||t.go("tab.subjects")})}else t.go("login")},function(e){t.go("login")}):t.go("login")})}]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("tab",{url:"/tab",abstract:!0,templateUrl:"templates/tabs/html/tabs.html"}).state("login",{url:"/login",templateUrl:"templates/login/html/login.html",controller:"loginCtrl"}).state("chat",{url:"/chat",templateUrl:"templates/chat/html/chat.html",controller:"chatCtrl"}).state("userProfile",{url:"/userProfile/:userId/:first_name",templateUrl:"templates/profile/html/userProfile.html",controller:"userProfileCtrl"}).state("blockedUsers",{url:"/blockedUsers",templateUrl:"templates/blockedUsers/html/blockedUsers.html",controller:"blockedUsersCtrl"}).state("tab.subjects",{url:"/subjects",views:{"tab-subjects":{templateUrl:"templates/subjects/html/subjects.html",controller:"subjectsCtrl"}}}).state("tab.addSubject-s1",{url:"/addSubject-s1",views:{"tab-addSubject":{templateUrl:"templates/subjects/html/addSubject-s1.html",controller:"addSubjectCtrl"}}}).state("tab.addSubject-s2",{url:"/addSubject-s2/:categoryId",views:{"tab-addSubject":{templateUrl:"templates/subjects/html/addSubject-s2.html",controller:"addSubjectCtrl"}}}).state("tab.messages",{url:"/messages",views:{"tab-messages":{templateUrl:"templates/messages/html/messages.html",controller:"messagesCtrl"}}}).state("tab.myProfile",{url:"/myProfile",views:{"tab-myProfile":{templateUrl:"templates/profile/html/myProfile.html",controller:"myProfileCtrl"}}})}])}();var common=new function(){this.indexOfConv=function(e,t){for(var o=0;o<e.length;o++)if(e[o].conversationId===t)return o;return-1}},appControllers=angular.module("starter.controllers",[]),appServices=angular.module("starter.services",[]);appControllers.controller("NewMessagesCtrl",["$scope","MessagesService",function(e,t){e.checkUndreadMessage=function(){return t.checkUndreadMessage()}}]),appControllers.controller("tabsCtrl",["$scope","MessagesService",function(e,t){e.checkUndreadMessage=function(){return t.checkUndreadMessage()}}]),appControllers.controller("AppCtrl",["$scope","$state","$ionicHistory",function(e,t,o){e.goBack=function(){t.current.name.indexOf("chat")>=0?t.go("tab.messages"):o.goBack()}}]),appServices.factory("backcallFactory",["$state","$rootScope","$ionicPlatform","$ionicHistory","$timeout",function(e,t,o,r,s){var n={};return n.backCall=function(){var n=0;o.registerBackButtonAction(function(){"tab.subjects"===e.current.name||"tab.addSubject-s1"===e.current.name||"tab.messages"===e.current.name||"tab.myProfile"===e.current.name?0==n?(n++,window.plugins.toast.showShortBottom("press back button again to exit."),s(function(){n=0},3e3)):navigator.app.exitApp():e.current.name.indexOf("chat")>=0?e.go("tab.messages"):null!=r.viewHistory().backView?r.goBack():t.TabName?(e.go(t.TabName),r.clearHistory(),r.clearCache()):e.go("tab.subjects")},100)},n}]),function(){appServices.factory("ChatService",["$q","$timeout","SubjectService","$rootScope","$ionicScrollDelegate","$firebaseObject","$firebaseArray","ConfigurationService","NotificationService","$http",function(e,t,o,r,s,n,i,a,c,l){var u,f,d,g,d,b,p,m,h,v,S,U,j=[],w=a.UserDetails(),$=w.first_name+" "+w.last_name,k=!1,y=function(){s.scrollBottom(!1)};return{getMessages:function(){return j},setMessages:function(e){u=e,d=u.split("-")[0],g=u.split("-")[1],f=w._id+"-"+g,p="https://chatoi.firebaseio.com/chats/"+d+"/"+f,b="https://chatoi.firebaseio.com/chats/"+w._id+"/"+u,m=new Firebase("https://chatoi.firebaseio.com/conversationOnline/"+w._id),h=new Firebase("https://chatoi.firebaseio.com/conversationOnline/"+d),S=new Firebase(p+"/read"),v=new Firebase(b+"/read"),v.set(!0),m.set({conversationId:e});var t="https://chatoi.firebaseio.com/chats/"+d+"/blocked/"+w._id,o=new Firebase(t);o.on("value",function(e){k=!!e.val()});var s=new Firebase("https://chatoi.firebaseio.com/presence/"+d);s.on("value",function(e){e.val()&&"online"==e.val()?r.$broadcast("sendUserOnlineEvent",!0):r.$broadcast("sendUserOnlineEvent",!1)});var n=new Firebase("https://chatoi.firebaseio.com/chats/"+w._id+"/"+u),a=new Firebase("https://chatoi.firebaseio.com/chats/"+w._id+"/"+u+"/messages"),c=i(a);c.$loaded(function(e){j=e,r.$broadcast("sendChatEvent","sendChatEvent")}),n.on("value",function(e){U=!1;var t=[];t=e.val().messages;var o=0,r=0;angular.forEach(t,function(e,s){3==o&&o==r&&(U=!0),4==o&&t[s].sender!=w._id&&(U=!1),t[s].sender==w._id&&r++,o++}),y()})},blockUser:function(e){d=u.split("-")[0];var t=new Firebase("https://chatoi.firebaseio.com/chats/"+w._id+"/blocked/"+d);t.set({userName:e.userName,fbPhotoUrl:e.fbPhotoUrl,userId:d})},sendMessage:function(e,t){if(U)return void a.showAlert();var r,s,i=!1;if(f=w._id+"-"+g,j&&0!=j.length||(i=!0),i){o.Interested(g).then(function(e){},function(e){}),s=new Firebase(p),r=new Firebase(b);var l={userName:$,subjectName:t.subjectName,fbPhotoUrl:w.fbPhotoUrl,desc:t.desc};r.set({userName:t.userName,subjectName:t.subjectName,fbPhotoUrl:t.fbPhotoUrl,read:!0,desc:t.desc}),k&&(l.read=!0),s.set(l),i=!1}s=new Firebase(p+"/messages"),r=new Firebase(b+"/messages");var u=s.push(),m=r.push(),v=new Date,y={body:e,sender:w._id,create_date:v.toJSON(),date_string:v.toLocaleDateString()};if(m.set(y),!k){u.set(y);var C=n(h);C.$loaded(function(e){e?e.conversationId!==f?S.set(!1):S.set(!0):S.set(!1)});var D=new Firebase("https://chatoi.firebaseio.com/presence/"+d),F=n(D);F.$loaded(function(o){if(o&&"offline"==o.$value){var r={user:d,message:e,conversationId:f,userName:$,subjectName:t.subjectName,fbPhotoUrl:w.fbPhotoUrl,desc:t.desc};c.SendMessage(r).then(function(e){},function(e){})}})}},ReportUser:function(t){var o=e.defer();return l.post(a.ServerUrl()+"/api/users/report",t,{headers:{"access-token":a.UserDetails().token}}).success(function(e){o.resolve(e)}).error(function(e,t){o.reject(e)}),o.promise},scrollBottom:y}}])}(),function(){appServices.factory("ConfigurationService",["$ionicPopup",function(e){return{ServerUrl:function(){return"https://chatad.herokuapp.com"},CategoriesUrl:function(){return"https://chatad.herokuapp.com/categories/"},UserDetails:function(){return this.userDetails||window.localStorage.user&&(this.userDetails=angular.fromJson(window.localStorage.user)),this.userDetails},RefreshUserDetails:function(){return window.localStorage.user&&(this.userDetails=angular.fromJson(window.localStorage.user)),this.userDetails},Notification_token:function(){return this.notification_token||window.localStorage.notification_token&&(this.notification_token=window.localStorage.notification_token),this.notification_token},MyFilter:function(){this.myFilter||window.localStorage.myFilter&&(this.myFilter=angular.fromJson(window.localStorage.myFilter));var e={};return angular.copy(this.myFilter,e),e},SetMyFilter:function(e){e&&(window.localStorage.myFilter=angular.toJson(e),this.myFilter=e)},SetNotification_token:function(e){e&&(window.localStorage.notification_token=angular.toJson(e),this.notification_token=e)},showAlert:function(){var t=e.alert({title:"info",template:"wiat for the other user to answer you"});t.then(function(e){console.log("Thank you for not eating my delicious ice cream cone")})},LogOut:function(){delete this.notification_token,delete this.myFilter,delete this.userDetails}}}])}(),function(){appServices.factory("EntityService",["ConfigurationService","$q",function(e,t){var o=null,r=null,s=function(e,t){for(var o=0;o<e.length;o++)e[o]._id==t._id&&e.splice(o,1)},n=function(e){o=e},i=function(){return o},a=function(e){r=e},c=function(){return r};return{deleteFromArray:s,setProfile:n,getOtherProfile:i,setMessageDetails:a,getMessageDetails:c}}])}(),function(){appServices.factory("MessagesService",["$rootScope","$ionicScrollDelegate","$firebaseObject","ConfigurationService",function(e,t,o,r){var s=[],n=r.UserDetails(),i=function(){var t=new Firebase("https://chatoi.firebaseio.com/chats/"+n._id);t.on("value",function(t){s=[],angular.forEach(t.val(),function(t,r){var i=r;if(t.messages){var a=Object.getOwnPropertyNames(t.messages),c=a[a.length-1],l=t.messages[c].body,u=i.split("-")[0],f=!1;t.read&&(f=t.read);var d=common.indexOfConv(s,i),g={conversationId:i,lastMessage:l,lastMessageKey:c,subjectName:t.subjectName,fbPhotoUrl:t.fbPhotoUrl,userName:t.userName,readMessage:f,desc:t.desc};d===-1?s.push(g):s[d]=g;var b=new Firebase("https://chatoi.firebaseio.com/presence/"+u);b.on("value",function(t){var r=!0;"offline"==t.val()&&(r=!1);var a="https://chatoi.firebaseio.com/chats/"+u+"/blocked/"+n._id,c=new Firebase(a),l=o(c);l.$loaded(function(t){t.userId&&(r=!1);var o=common.indexOfConv(s,i);s[o].online=r,e.$broadcast("sendMessagesEvent","sendMessagesEvent")})})}})})};return i(),{getMessages:function(){return s},setMessages:function(){i()},checkUndreadMessage:function(){for(var e=0;e<s.length;e++)if(s[e].readMessage===!1)return!0;return!1}}}])}(),function(){appServices.factory("NotificationService",["$http","$log","$q","ConfigurationService",function(e,t,o,r){return{SendMessage:function(t){var s=o.defer();return e.post(r.ServerUrl()+"/api/notification",t,{headers:{"access-token":r.UserDetails().token}}).success(function(e){s.resolve(e)}).error(function(e,t){s.reject(e)}),s.promise}}}])}(),function(){appServices.factory("SubjectService",["$http","$log","$q","ConfigurationService","$cordovaGeolocation",function(e,t,o,r,s){return{TimeToUpdateFromServer:9e5,GetCategories:function(){var t=o.defer();return!r.categories||r.categories.datetime&&(new Date).getTime()-r.categories.datetime.getTime()>this.TimeToUpdateFromServer?e.get(r.ServerUrl()+"/api/subjects/categories",{headers:{"access-token":r.UserDetails().token}}).success(function(e){r.categories={data:e,datetime:new Date},t.resolve(e)}).error(function(e,o){t.reject(e)}):t.resolve(r.categories.data),t.promise},GetSubjects:function(t,n,i){function a(){e.post(r.ServerUrl()+"/api/subjects/filter?userSubjects="+t+"&userId="+i,l,{headers:{"access-token":r.UserDetails().token}}).success(function(e){c.resolve(e)}).error(function(e,t){c.reject(e)})}var c=o.defer();void 0==i&&(i=null);var l=r.MyFilter();if(l.limit=n.limit,l.skip=n.skip,l.gender||(l={nearMe:!1,gender:"both",categories:[]},r.SetMyFilter(l)),l.nearMe){var u={timeout:1e4,enableHighAccuracy:!1};s.getCurrentPosition(u).then(function(e){var t=e.coords.latitude,o=e.coords.longitude;l.locationCoords=[t,o],a()},function(e){l.locationCoords=[],a()})}else l.locationCoords=[],a();return c.promise},GetMySubjects:function(t,s){function n(){e.post(r.ServerUrl()+"/api/subjects/filter?userSubjects=true&status="+s+"&userId="+t,{},{headers:{"access-token":r.UserDetails().token}}).success(function(e){i.resolve(e)}).error(function(e,t){i.reject(e)})}var i=o.defer();return void 0==t&&(t=null),n(),i.promise},Interested:function(t){var s=o.defer();return e.post(r.ServerUrl()+"/api/subjects/interested",{subjectId:t},{headers:{"access-token":r.UserDetails().token}}).success(function(e){s.resolve(e)}).error(function(e,t){s.reject(e)}),s.promise},ChangeStatus:function(t,s){var n=o.defer();return e.post(r.ServerUrl()+"/api/subjects/status",{_id:t._id,status:s},{headers:{"access-token":r.UserDetails().token}}).success(function(e){n.resolve(e)}).error(function(e,t){n.reject(e)}),n.promise},CreateSubject:function(t){function n(){e.post(r.ServerUrl()+"/api/subjects",t,{headers:{"access-token":r.UserDetails().token}}).success(function(e){i.resolve(e)}).error(function(e,t){i.reject(e)})}var i=o.defer(),a={timeout:1e4,enableHighAccuracy:!1};return s.getCurrentPosition(a).then(function(e){var o=e.coords.latitude,r=e.coords.longitude;t.locationCoords=[o,r],n()},function(e){t.locationCoords=[],n()}),i.promise},DeleteSubjects:function(t){var s=o.defer();return e.delete(r.ServerUrl()+"/api/subjects?_id="+t._id,{headers:{"access-token":r.UserDetails().token}}).success(function(e){s.resolve(e)}).error(function(e,t){s.reject(e)}),s.promise}}}])}(),function(){appServices.factory("UserService",["$http","$log","$q","$cordovaFacebook","ConfigurationService",function(e,t,o,r,s){var n={};return{CreateUser:function(t){var r=o.defer();return e.post(s.ServerUrl()+"/api/users",t,{headers:{"Content-Type":"application/json"}}).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(e)}),r.promise},LogOut:function(){var t=o.defer();return e.get(s.ServerUrl()+"/api/users/logOut",{headers:{"Content-Type":"application/json","access-token":s.UserDetails().token}}).success(function(e){t.resolve(e)}).error(function(e,o){t.reject(e)}),t.promise},GetUser:function(t){var r=o.defer();return e.get(s.ServerUrl()+"/api/users/"+t,{headers:{"access-token":s.UserDetails().token}}).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(e)}),r.promise},CheckUser:function(t){var r=o.defer();return e.get(s.ServerUrl()+"/api/users",{headers:{"access-token":s.UserDetails().token}}).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(e)}),r.promise},FBlogin:function(){var e=o.defer();return r.login(["public_profile","email","user_friends","user_birthday"]).then(function(t){e.resolve(t)},function(t){alert(JSON.stringify(t)),e.reject(t)}),e.promise},RegisterNotification:function(t){var r=o.defer();return e.post(s.ServerUrl()+"/api/users/notification",{notification_token:t},{headers:{"access-token":s.UserDetails().token}}).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(e)}),r.promise},SetUserProfile:function(e){var t=e.conversationId.split("-")[0];n.userId=t,n.first_name=e.userName,n.fbPhotoUrl=e.fbPhotoUrl},GetUserProfile:function(){return n}}}])}(),function(){appControllers.controller("blockedUsersCtrl",["$scope","$rootScope","$state","$ionicPopup","$stateParams","$filter","$firebaseArray","$mdBottomSheet","$mdDialog","$mdToast","$ionicHistory","SubjectService","ConfigurationService","Firebase",function(e,t,o,r,s,n,i,a,c,l,u,f,d,g){e.isExpanded=!0,t.isHeaderExpanded=!0,e.showConfirm=function(t){var o=r.confirm({title:"Unblock User",template:"Are you sure you want to remove"+t.userName+" from your blocked users?"});o.then(function(o){if(o){var r=new g("https://chatoi.firebaseio.com/chats/"+e.userDetails._id+"/blocked/"+t.userId);r.remove(),console.log("You are sure")}else console.log("You are not sure")})},e.userDetails=d.UserDetails(),e.initialForm=function(){var t=new g("https://chatoi.firebaseio.com/chats/"+e.userDetails._id+"/blocked/");e.blockedUsers=i(t)},e.initialForm()}])}(),function(){appControllers.controller("chatCtrl",["$scope","$ionicPopover","$timeout","$ionicScrollDelegate","$rootScope","$state","$ionicPopup","ConfigurationService","ChatService","UserService","EntityService",function(e,t,o,r,s,n,i,a,c,l,u){var f=new Date;e.dateString=f.toLocaleDateString(),e.isExpanded=!0,s.isHeaderExpanded=!0,e.chatDetails=u.getMessageDetails(),e.conversationId=e.chatDetails.conversationId,e.messages=[];var d=e.conversationId.split("-")[0];e.userDetails=a.UserDetails(),c.setMessages(e.conversationId),e.messages=c.getMessages(),o(function(){c.scrollBottom()},100),window.addEventListener("native.keyboardshow",function(){o(function(){r.scrollBottom(!1)},300)}),s.$on("sendChatEvent",function(t,o){e.messages=c.getMessages(),f=new Date,e.dateString=f.toLocaleDateString(),e.$$phase||e.$apply()});var g="https://chatoi.firebaseio.com/chats/"+e.userDetails._id+"/blocked/"+d,b=new Firebase(g);b.on("value",function(t){t.val()?(e.disableSend=!0,e.sendInputPlaceHolder="this user is blocked"):(e.disableSend=!1,e.sendInputPlaceHolder="Message")}),e.blockUser=function(){var t=i.confirm({title:"Block User",template:"Are you sure you want to block "+e.chatDetails.userName+" ?",buttons:[{text:"Cancel"},{text:"<b>Block</b>",type:"button-positive",onTap:function(e){return"sss"}}]});t.then(function(t){t?(c.blockUser(e.chatDetails),console.log("You are sure")):console.log("You are not sure")})},e.reportUser=function(){e.data={is_toBlocked:!0,reason:""};var t=i.show({title:"Report User",template:'<textarea cols="4" ng-model="data.reason" placeholder="Giv us more details"></textarea>  <ion-checkbox ng-model="data.is_toBlocked" >Also block this user ? </ion-checkbox>',scope:e,buttons:[{text:"Cancel"},{text:"<b>Report</b>",type:"button-positive",onTap:function(t){return{is_toBlocked:e.data.is_toBlocked,report:{user:e.chatDetails.conversationId.split("-")[1],reason:e.data.reason}}}}]});t.then(function(t){t?(c.ReportUser(t.report),t.is_toBlocked&&c.blockUser(e.chatDetails),console.log("You are sure")):console.log("You are not sure")})},e.$on("$stateChangeStart",function(t,o,r,s,n,i){conversationUserRef=new Firebase("https://chatoi.firebaseio.com/conversationOnline/"+e.userDetails._id),conversationUserRef.remove()}),e.messageIsMine=function(t){return e.userDetails._id===t},e.getBubbleClass=function(t){var o="from-them";return e.messageIsMine(t)&&(o="from-me"),o},e.goToUserProfile=function(){l.SetUserProfile(e.chatDetails),n.go("app.userProfile",{userId:d})},e.sendMessage=function(t){f=new Date,e.dateString=f.toLocaleDateString(),c.sendMessage(t,e.chatDetails),e.data.message=""},t.fromTemplateUrl("templates/shared/drop-down-menu.html",{scope:e}).then(function(t){e.popover=t})}]),appControllers.controller("OnlineUserCtrl",["$scope","$firebaseObject","ConfigurationService","EntityService",function(e,t,o,r){var s=o.UserDetails(),n=r.getMessageDetails(),i=n.conversationId,a=i.split("-")[0],c=new Firebase("https://chatoi.firebaseio.com/presence/"+a),l="https://chatoi.firebaseio.com/chats/"+a+"/blocked/"+s._id,u=new Firebase(l),f=t(u);f.$loaded(function(t){t.userId?e.isUserOnline=!1:c.on("value",function(t){t.val()&&"online"==t.val()?e.isUserOnline=!0:e.isUserOnline=!1})})}])}(),function(){appControllers.controller("loginCtrl",["$scope","$state","UserService","$timeout",function(e,t,o,r){e.fbLogin=function(){if(console.log("fblogin"),window.cordova)o.FBlogin().then(function(e){window.localStorage.fbData=angular.toJson(e.authResponse);var r=e.authResponse,s={fbToken:r.accessToken};console.log(r.accessToken),o.CreateUser(s).then(function(e){console.log("create"),window.localStorage.user=angular.toJson(e);var o=new Firebase("https://chatoi.firebaseio.com");o.authWithCustomToken(e.fireToken,function(e,o){e?console.log("Login Failed!",e):(console.log("subjects"),t.go("tab.subjects"))}),t.go("tab.subjects")},function(e){console.log("Error ",e),alert("error")})},function(e){console.log("Error while performing Facebook login",e)});else{var e={fbToken:"EAAZAMbMtmoBIBAHHzKvk8AewEB55ZAVYLLIr0ofhi6Eyhrnd6aHdOB1gQO3Im86QmqooFAZAHyj0uXAtwWOTXCnFRU6IvvhS4z7JZCZB12h8fTMsxr9JAZAHH40f2aqIodDXlbdIEMHHd6ZA3YHzrLm97jQh6VTha199Qst6u4ukO2mYvO4II5X8ZBTrVmT1yeIZD",notification_token:"b95a00b4-96e0-41c6-9331-fa787a54291b"};o.CreateUser(e).then(function(e){window.localStorage.user=angular.toJson(e);var o=new Firebase("https://chatoi.firebaseio.com");o.authWithCustomToken(e.fireToken,function(e,o){e?console.log("Login Failed!",e):t.go("tab.subjects")}),t.go("tab.subjects")},function(e){})}}}])}(),function(){appControllers.controller("messagesCtrl",["$scope","$rootScope","$state","$stateParams","$timeout","$firebaseArray","ConfigurationService","MessagesService","UserService","EntityService",function(e,t,o,r,s,n,i,a,c,l){t.isHeaderExpanded=!0,e.$on("sendMessagesEvent",function(t,o){e.messages=a.getMessages(),e.$$phase||e.$apply()}),a.setMessages(),e.goToChat=function(e){var t={conversationId:e.conversationId,fbPhotoUrl:e.fbPhotoUrl,userName:e.userName,subjectName:e.subjectName,desc:e.desc};l.setMessageDetails(t),o.go("chat",{conversationId:e.conversationId})},e.goToUserProfile=function(e){c.SetUserProfile(e),o.go("userProfile")}}])}(),function(){appControllers.controller("myProfileCtrl",["$rootScope","$ionicPopup","UserService","$firebaseArray","$ionicLoading","$scope","$state","$stateParams","EntityService","SubjectService","ConfigurationService",function(e,t,o,r,s,n,i,a,c,l,u){n.userProfile=u.UserDetails(),n.categoriesUrl=u.CategoriesUrl(),n.subjects=[],n.deleteSubject=function(e,t){n.subjects.splice(e,1),l.DeleteSubjects(t).then(function(){},function(e){})},n.logOut=function(){o.LogOut().then(function(){window.localStorage.clear(),u.LogOut(),i.go("login")},function(e){i.go("login")})},n.tab="open",n.updateProfile=function(){var e={fbToken:n.userProfile.fbToken};o.CreateUser(e).then(function(e){window.localStorage.user=angular.toJson(e),n.userProfile=u.RefreshUserDetails()},function(e){console.log("Error ",e)})},n.getSubjects=function(e){if(n.tab=e,n.subjects=[],s.show(),"open"==e)l.GetMySubjects(n.userProfile._id,!0).then(function(e){n.subjects=e.subjects,s.hide()},function(e){s.hide()});else if("closed"==e)l.GetMySubjects(n.userProfile._id,!1).then(function(e){n.subjects=e.subjects,s.hide()},function(e){s.hide()});else if("blocked"==e){var t=new Firebase("https://chatoi.firebaseio.com/chats/"+n.userDetails._id+"/blocked/");n.blockedUsers=r(t),s.hide()}},n.changeStatus=function(e,t,o){n.subjects.splice(t,1),l.ChangeStatus(e,o).then(function(e){},function(e){})},n.getSubjects("open"),n.showConfirm=function(e){var o=t.confirm({title:"Unblock User",template:"Are you sure you want to remove"+e.userName+" from your blocked users?"});o.then(function(t){if(t){var o=new Firebase("https://chatoi.firebaseio.com/chats/"+n.userDetails._id+"/blocked/"+e.userId);o.remove(),console.log("You are sure")}else console.log("You are not sure")})},n.userDetails=u.UserDetails()}]),appControllers.controller("userProfileCtrl",["$rootScope","$scope","$state","$stateParams","EntityService","SubjectService","UserService",function(e,t,o,r,s,n,i){t.isExpanded=!0,e.isHeaderExpanded=!1,t.userProfile=i.GetUserProfile(),t.first_name=t.userProfile.first_name,t.a=function(){o.go("app.subjects")},t.isAnimated=r.isAnimated,t.subjects=[],n.GetMySubjects(t.userProfile.userId).then(function(e){t.subjects=e},function(e){}),t.goToSetting=function(){o.go("app.expenseSetting")}}]),appControllers.controller("profileSettingCtrl",["$scope","$state","$ionicHistory","$ionicViewSwitcher",function(e,t,o,r){e.navigateTo=function(e,s){o.currentStateName()!=e&&(o.nextViewOptions({disableAnimate:!1,disableBack:!0}),r.nextDirection("back"),t.go(e,{isAnimated:s}))}}])}(),function(){appControllers.controller("subjectsCtrl",["$scope","$ionicScrollDelegate","$ionicModal","$ionicPlatform","$rootScope","$state","$interval","$stateParams","$timeout","SubjectService","EntityService","UserService","MessagesService","ConfigurationService","backcallFactory",function(e,t,o,r,s,n,i,a,c,l,u,f,d,g,b){function p(t){l.GetSubjects(!1,e.scrollOptions).then(function(o){var r=[];angular.forEach(o.subjects,function(e){r.push(e)}),e.subjectsCount=o.count,e.subjectsCount=o.count,t(r)},function(e){})}function m(){l.GetSubjects(!1,e.scrollOptions).then(function(t){e.subjects=[],angular.forEach(t.subjects,function(t){e.subjects.push(t)}),e.subjectsCount=t.count},function(e){})}e.show=function(){var e=document.getElementById("dropdown-content");e.style.display="block"},e.scrollOptions={skip:0,limit:20},e.loadOlderSubjects=function(){e.subjects.length>0&&(e.scrollOptions.skip=e.subjects.length,e.scrollOptions.limit=20),p(function(o){e.subjects=e.subjects.concat(o),e.$broadcast("scroll.infiniteScrollComplete"),t.scrollBottom()})},e.loadNewrSubjects=function(){e.scrollOptions={skip:0,limit:20},p(function(t){e.subjects=[],e.subjects=e.subjects.concat(t),e.$broadcast("scroll.refreshComplete")})},e.subjects=[],l.GetCategories().then(function(e){},function(e){}),r.ready(function(){if(m(),b.backCall(),window.cordova&&"undefined"!=typeof window.plugins.OneSignal&&!g.Notification_token()&&c(function(){window.plugins.OneSignal.getIds(function(e){f.RegisterNotification(e.userId).then(function(e){g.SetNotification_token(e)},function(e){})})},5e3),e.userDetails=g.UserDetails(),e.userDetails){var t=new Firebase("https://chatoi.firebaseio.com/.info/connected"),o=new Firebase("https://chatoi.firebaseio.com/presence/"+e.userDetails._id),r=new Firebase("https://chatoi.firebaseio.com/conversationOnline/"+e.userDetails._id);t.on("value",function(e){e.val()&&(o.onDisconnect().set("offline"),r.onDisconnect().remove(),o.set("online"))})}}),e.checkUndreadMessage=function(){return d.checkUndreadMessage()},e.goToChat=function(e){var t=e.user.first_name+" "+e.user.last_name,o={conversationId:e.user._id+"-"+e._id,userName:t,subjectName:e.title,fbPhotoUrl:e.user.fbPhotoUrl,desc:e.description};u.setMessageDetails(o),n.go("chat")},e.goToUserProfile=function(e){n.go("userProfile",{userId:e.user._id,first_name:e.user.first_name})},e.goToFilter=function(){e.modal.show()},e.goToMessages=function(){n.go("tab.messages")},e.goToAddSubject=function(){n.go("addSubject")},o.fromTemplateUrl("templates/subjects/html/filter.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.$on("$destroy",function(){e.modal.remove(),console.log("$destroy")}),e.$on("modal.hidden",function(){console.log("modal hiden"),s.myFilter.categories=[],e.scrollOptions={skip:0,limit:20},l.GetCategories().then(function(t){e.categories=t,angular.forEach(e.categories,function(e,t){e.is_selected&&s.myFilter.categories.push(e._id)}),g.SetMyFilter(s.myFilter),m()},function(e){})}),e.$on("modal.removed",function(){console.log("removed")})}]),appControllers.controller("addSubjectCtrl",["$scope","$ionicLoading","$state","SubjectService","$stateParams","$filter","$ionicHistory","ConfigurationService","$ionicHistory",function(e,t,o,r,s,n,i,a,i){e.isExpanded=!0,e.failed=!1,e.subject={},e.categories=[],e.categoriesUrl=a.CategoriesUrl(),e.initialForm=function(){e.subject={title:"",user:a.UserDetails()._id,description:""},r.GetCategories().then(function(t){e.categories=t},function(e){})},e.createSubjectSetp=function(e){o.go("tab.addSubject-s2",{categoryId:e._id})},e.createSubject=function(){return e.subject.description.length<=0?void(e.failed=!0):(e.subject.category=o.params.categoryId,t.show(),void r.CreateSubject(e.subject).then(function(){t.hide(),i.clearHistory(),o.go("tab.subjects")},function(e){t.hide()}))},e.initialForm()}]),appControllers.controller("filterCtrl",["$scope","$rootScope","$state","$stateParams","$ionicHistory","SubjectService","ConfigurationService",function(e,t,o,r,s,n,i){e.categoriesUrl=i.CategoriesUrl(),e.setGender=function(e){t.myFilter.gender=e},e.selectCategory=function(t){e.categories[t].is_selected?e.categories[t].is_selected=!1:e.categories[t].is_selected=!0},e.initialForm=function(){n.GetCategories().then(function(o){e.categories=o;for(var r=0;r<e.categories.length;r++)t.myFilter.categories.indexOf(e.categories[r]._id)!==-1&&(e.categories[r].is_selected=!0)},function(e){}),t.myFilter=i.MyFilter(),t.myFilter.gender||(t.myFilter={nearMe:!1,gender:"both",categories:[]},i.SetMyFilter(t.myFilter))},e.initialForm()}])}();